<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Audio Codec Samples - Different BPS</title>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
    <script src="https://unpkg.com/wavesurfer.js@6.6.3/dist/wavesurfer.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 20px; background-color: #f5f5f5; }
        .container { max-width: 1200px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        #text1 { font-size: 24px; font-weight: bold; text-align: center; margin-bottom: 20px; color: #333; }
        #intro { text-align: center; margin-bottom: 30px; color: #666; }
        .content-container { max-width: 1200px; margin: 30px auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .content-title { font-size: 20px; font-weight: bold; margin-bottom: 20px; color: #444; border-bottom: 2px solid #eee; padding-bottom: 10px; }
        .inlineTable { width: 100%; border-collapse: collapse; margin: 10px 0; }
        .inlineTable th, .inlineTable td { padding: 12px; text-align: center; border: 1px solid #ddd; }
        .inlineTable th { background: #f8f8f8; font-weight: bold; color: #333; }
        .play-button-demo { 
            background: #4CAF50; color: white; border: none; padding: 8px 15px; 
            border-radius: 4px; cursor: pointer; margin-top: 5px; font-size: 14px;
            transition: background 0.3s;
        }
        .play-button-demo:hover { background: #45a049; }
        .play-button-demo:disabled { background: #ccc; cursor: not-allowed; }
        [id*="waveform-"] { height: 80px; margin-bottom: 5px; }
        #global-status { 
            position: fixed; top: 20px; right: 20px; padding: 10px 20px; 
            background: #fff; border-radius: 4px; box-shadow: 0 2px 8px rgba(0,0,0,0.2); 
            z-index: 9999; min-width: 200px; text-align: center;
        }
        .loading { color: #ff9800; }
        .success { color: #4CAF50; }
        .error { color: #f44336; }
        .audio-hidden { display: none; }
    </style>
</head>
<body>
<div id="global-status" class="success">就绪：点击按钮播放音频</div>
<div class="container">
    <div id="text1">Audio Codec Samples <br/> Playback by Different BPS (640/1200/3000)</div>
    <div id="intro">
        <p>Speech Codec Audio Samples - Groundtruth and Various Codec Comparisons</p>
        <p>Supported BPS: 640bps, 1200bps, 3000bps</p>
        <p>Codecs: groundtruth, encodec, hificodec, ticodec, wavtokenizer, cCodec</p>
    </div>
</div>

<!-- 640bps 音频样本容器 -->
<div class="content-container">
    <div class="content-title">640bps Samples</div>
    <!-- s1 样本表格 -->
    <h3>Sample s1</h3>
    <table class="inlineTable">
        <thead>
            <tr>
                <th>Codec Type</th>
                <th>Waveform</th>
                <th>Playback</th>
            </tr>
        </thead>
        <tbody>
            <!-- Groundtruth -->
            <tr>
                <td>Groundtruth</td>
                <td>
                    <div id="waveform-640_s1_groundtruth"></div>
                    <audio id="audio-640_s1_groundtruth" class="audio-hidden" preload="none">
                        <source src="https://shaokai1209.github.io/c-Codec/samples/640bps/s1/121_121726_000004_000003.wav" type="audio/wav">
                    
                </td>
                <td><button class="play-button-demo" onclick="togglePlay('640_s1_groundtruth')">播放</button></td>
            </tr>
            <!-- Encodec -->
            <tr>
                <td>Encodec</td>
                <td>
                    <div id="waveform-640_s1_encodec"></div>
                    <audio id="audio-640_s1_encodec" class="audio-hidden" preload="none">
                        <source src="https://shaokai1209.github.io/c-Codec/samples/640bps/s1/121_121726_000004_000003_encodec_640.wav" type="audio/wav">
                    
                </td>
                <td><button class="play-button-demo" onclick="togglePlay('640_s1_encodec')">播放</button></td>
            </tr>
            <!-- HiFiCodec -->
            <tr>
                <td>HiFiCodec</td>
                <td>
                    <div id="waveform-640_s1_hifi"></div>
                    <audio id="audio-640_s1_hifi" class="audio-hidden" preload="none">
                        <source src="https://shaokai1209.github.io/c-Codec/samples/640bps/s1/121_121726_000004_000003_hifi_640.wav" type="audio/wav">
                    
                </td>
                <td><button class="play-button-demo" onclick="togglePlay('640_s1_hifi')">播放</button></td>
            </tr>
            <!-- TiCodec -->
            <tr>
                <td>TiCodec</td>
                <td>
                    <div id="waveform-640_s1_ticodec"></div>
                    <audio id="audio-640_s1_ticodec" class="audio-hidden" preload="none">
                        <source src="https://shaokai1209.github.io/c-Codec/samples/640bps/s1/121_1/121_121726_000004_000003_ticodec_640.wav" type="audio/wav">
                    
                </td>
                <td><button class="play-button-demo" onclick="togglePlay('640_s1_ticodec')">播放</button></td>
            </tr>
            <!-- WavTokenizer -->
            <tr>
                <td>WavTokenizer</td>
                <td>
                    <div id="waveform-640_s1_wavt"></div>
                    <audio id="audio-640_s1_wavt" class="audio-hidden" preload="none">
                        <source src="https://shaokai1209.github.io/c-Codec/samples/640bps/s1/121_121726_000004_000003_wavt_640.wav" type="audio/wav">
                    
                </td>
                <td><button class="play-button-demo" onclick="togglePlay('640_s1_wavt')">播放</button></td>
            </tr>
            <!-- cCodec -->
            <tr>
                <td>cCodec</td>
                <td>
                    <div id="waveform-640_s1_ccodec"></div>
                    <audio id="audio-640_s1_ccodec" class="audio-hidden" preload="none">
                        <source src="https://shaokai1209.github.io/c-Codec/samples/640bps/s1/121_121726_000004_000003_cCodec_640.wav" type="audio/wav">
                    
                </td>
                <td><button class="play-button-demo" onclick="togglePlay('640_s1_ccodec')">播放</button></td>
            </tr>
        </tbody>
    </table>

    <!-- s2 样本表格 -->
    <h3>Sample s2</h3>
    <table class="inlineTable">
        <thead>
            <tr>
                <th>Codec Type</th>
                <th>Waveform</th>
                <th>Playback</th>
            </tr>
        </thead>
        <tbody>
            <!-- Groundtruth -->
            <tr>
                <td>Groundtruth</td>
                <td>
                    <div id="waveform-640_s2_groundtruth"></div>
                    <audio id="audio-640_s2_groundtruth" class="audio-hidden" preload="none">
                        <source src="https://shaokai1209.github.io/c-Codec/samples/640bps/s2/121_121726_000005_000001.wav" type="audio/wav">
                    
                </td>
                <td><button class="play-button-demo" onclick="togglePlay('640_s2_groundtruth')">播放</button></td>
            </tr>
            <!-- Encodec -->
            <tr>
                <td>Encodec</td>
                <td>
                    <div id="waveform-640_s2_encodec"></div>
                    <audio id="audio-640_s2_encodec" class="audio-hidden" preload="none">
                        <source src="https://shaokai1209.github.io/c-Codec/samples/640bps/s2/121_121726_000005_000001_encodec_640.wav" type="audio/wav">
                    
                </td>
                <td><button class="play-button-demo" onclick="togglePlay('640_s2_encodec')">播放</button></td>
            </tr>
            <!-- HiFiCodec -->
            <tr>
                <td>HiFiCodec</td>
                <td>
                    <div id="waveform-640_s2_hifi"></div>
                    <audio id="audio-640_s2_hifi" class="audio-hidden" preload="none">
                        <source src="https://shaokai1209.github.io/c-Codec/samples/640bps/s2/121_121726_000005_000001_hifi_640.wav" type="audio/wav">
                    
                </td>
                <td><button class="play-button-demo" onclick="togglePlay('640_s2_hifi')">播放</button></td>
            </tr>
            <!-- TiCodec -->
            <tr>
                <td>TiCodec</td>
                <td>
                    <div id="waveform-640_s2_ticodec"></div>
                    <audio id="audio-640_s2_ticodec" class="audio-hidden" preload="none">
                        <source src="https://shaokai1209.github.io/c-Codec/samples/640bps/s2/121_121726_000005_000001_ticodec_640.wav" type="audio/wav">
                    
                </td>
                <td><button class="play-button-demo" onclick="togglePlay('640_s2_ticodec')">播放</button></td>
            </tr>
            <!-- WavTokenizer -->
            <tr>
                <td>WavTokenizer</td>
                <td>
                    <div id="waveform-640_s2_wavt"></div>
                    <audio id="audio-640_s2_wavt" class="audio-hidden" preload="none">
                        <source src="https://shaokai1209.github.io/c-Codec/samples/640bps/s2/121_121726_000005_000001_wavt_640.wav" type="audio/wav">
                    
                </td>
                <td><button class="play-button-demo" onclick="togglePlay('640_s2_wavt')">播放</button></td>
            </tr>
            <!-- cCodec -->
            <tr>
                <td>cCodec</td>
                <td>
                    <div id="waveform-640_s2_ccodec"></div>
                    <audio id="audio-640_s2_ccodec" class="audio-hidden" preload="none">
                        <source src="https://shaokai1209.github.io/c-Codec/samples/640bps/s2/121_121726_000005_000001_cCodec_640.wav" type="audio/wav">
                    
                </td>
                <td><button class="play-button-demo" onclick="togglePlay('640_s2_ccodec')">播放</button></td>
            </tr>
        </tbody>
    </table>
</div>

<script>
    // 缓存Wavesurfer实例
    const wsInstances = {};
    const statusEl = document.getElementById('global-status');
    let currentPlayingId = null; // 记录当前播放的音频ID，实现互斥播放

    /**
     * 初始化Wavesurfer实例（挂载到已有audio元素）
     * @param {string} id - 唯一标识（如640_s1_groundtruth）
     */
    function initWs(id) {
        if (wsInstances[id]) return wsInstances[id];

        const audioEl = document.getElementById(`audio-${id}`);
        const ws = WaveSurfer.create({
            container: `#waveform-${id}`,
            waveColor: 'violet',
            progressColor: 'purple',
            cursorColor: 'red',
            barWidth: 2,
            barRadius: 3,
            height: 80,
            backend: 'MediaElement', // 改用MediaElement后端，兼容更好
            mediaElement: audioEl,   // 挂载到原生audio元素
            normalize: true
        });

        // 监听音频加载状态
        audioEl.addEventListener('loadeddata', () => {
            statusEl.className = 'success';
            statusEl.textContent = `音频就绪: ${id}`;
        });

        // 监听音频错误
        audioEl.addEventListener('error', (e) => {
            const errMsg = `音频加载失败: ${e.target.error.message}`;
            statusEl.className = 'error';
            statusEl.textContent = errMsg;
            alert(errMsg);
        });

        wsInstances[id] = ws;
        return ws;
    }

    /**
     * 播放/暂停切换（互斥播放：同一时间只播放一个音频）
     * @param {string} id - 唯一标识
     */
    function togglePlay(id) {
        const btn = event.target;
        const audioEl = document.getElementById(`audio-${id}`);
        const ws = initWs(id);

        // 1. 如果当前有音频在播放，先暂停
        if (currentPlayingId && currentPlayingId !== id) {
            const currentAudio = document.getElementById(`audio-${currentPlayingId}`);
            const currentWs = wsInstances[currentPlayingId];
            const currentBtn = document.querySelector(`button[onclick="togglePlay('${currentPlayingId}')"]`);
            
            currentAudio.pause();
            currentWs.pause();
            currentBtn.textContent = '播放';
        }

        // 2. 切换当前音频状态
        if (audioEl.paused) {
            // 开始播放
            audioEl.play().then(() => {
                ws.play();
                btn.textContent = '暂停';
                statusEl.className = 'success';
                statusEl.textContent = `播放中: ${id}`;
                currentPlayingId = id;
            }).catch((e) => {
                statusEl.className = 'error';
                statusEl.textContent = `播放失败: ${e.message}`;
                alert(`播放失败: ${e.message}\n请检查浏览器音频权限`);
            });
        } else {
            // 暂停播放
            audioEl.pause();
            ws.pause();
            btn.textContent = '播放';
            statusEl.className = 'success';
            statusEl.textContent = `已暂停: ${id}`;
            currentPlayingId = null;
        }
    }

    // 页面卸载时清理资源
    window.onbeforeunload = () => {
        Object.values(wsInstances).forEach(ws => ws.destroy());
        document.querySelectorAll('audio').forEach(audio => audio.pause());
    };
</script>
</body>
</html>

