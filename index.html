<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>c-Codec 音频播放</title>
    <style>
        .audio-btn { margin: 10px; padding: 10px 20px; font-size: 14px; cursor: pointer; }
        #status { margin-top: 20px; color: #666; }
        audio { margin-top: 10px; width: 300px; }
    </style>
</head>
<body>
    <h1>c-Codec 音频样本播放</h1>
    <!-- 按钮绑定实际音频直链 -->
    <button class="audio-btn" 
            data-audio="https://raw.githubusercontent.com/shaokai1209/c-Codec/main/samples/1200bps/s1/121_121726_000004_000003_encodec_1500.wav">
        播放 1200bps 样本
    </button>
    <div id="status"></div>
    <!-- 备用音频播放器（手动控制） -->
    <audio controls id="audio-player">
        你的浏览器不支持音频播放
    </audio>

    <script>
        const buttons = document.querySelectorAll('.audio-btn');
        const statusDiv = document.getElementById('status');
        const audioPlayer = document.getElementById('audio-player');
        let currentAudio = null;

        buttons.forEach(btn => {
            btn.addEventListener('click', async () => {
                // 停止上一个音频
                if (currentAudio) {
                    currentAudio.pause();
                }

                // 获取音频直链
                const audioUrl = btn.getAttribute('data-audio');
                statusDiv.textContent = `正在加载: ${audioUrl}`;

                try {
                    // 方式1：通过Audio实例播放（兼容自动播放限制）
                    currentAudio = new Audio(audioUrl);
                    // 绑定到备用播放器（方便手动控制）
                    audioPlayer.src = audioUrl;

                    // 监听加载错误
                    currentAudio.addEventListener('error', (e) => {
                        const errCode = currentAudio.error.code;
                        const errMsg = {
                            1: '音频加载被中止',
                            2: '网络错误',
                            3: '解码失败（格式不支持/文件损坏）',
                            4: '资源不存在（路径错误）'
                        }[errCode] || '未知错误';
                        statusDiv.textContent = `加载失败: ${errMsg} (错误码: ${errCode})`;
                        console.error('音频错误详情:', e);
                    });

                    // 监听加载完成
                    currentAudio.addEventListener('canplay', () => {
                        statusDiv.textContent = '加载完成，正在播放...';
                    });

                    // 解决自动播放限制：先触发用户交互后播放
                    await currentAudio.play();
                    statusDiv.textContent = `正在播放: ${audioUrl}`;
                } catch (playErr) {
                    // 自动播放失败时提示手动播放
                    statusDiv.textContent = `自动播放失败（浏览器限制），请点击下方播放器播放`;
                    console.error('播放失败:', playErr);
                }
            });
        });
    </script>
</body>
</html>
