<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Audio Codec Samples - Different BPS</title>
    <link rel="stylesheet" type="text/css" href="css/styles.css">
    <script src="css/jquery-3.5.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
    <script src="https://unpkg.com/wavesurfer.js@6.6.3/dist/wavesurfer.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 20px; background-color: #f5f5f5; }
        .container { max-width: 1200px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        #text1 { font-size: 24px; font-weight: bold; text-align: center; margin-bottom: 20px; color: #333; }
        #intro { text-align: center; margin-bottom: 30px; color: #666; }
        .content-container { max-width: 1200px; margin: 30px auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .content-title { font-size: 20px; font-weight: bold; margin-bottom: 20px; color: #444; border-bottom: 2px solid #eee; padding-bottom: 10px; }
        .inlineTable { width: 100%; border-collapse: collapse; margin: 10px 0; }
        .inlineTable th, .inlineTable td { padding: 12px; text-align: center; border: 1px solid #ddd; }
        .inlineTable th { background: #f8f8f8; font-weight: bold; color: #333; }
        .play-button-demo { background: #4CAF50; color: white; border: none; padding: 8px 15px; border-radius: 4px; cursor: pointer; margin-top: 5px; font-size: 14px; }
        .play-button-demo:hover { background: #45a049; }
        [id*="waveform"] { height: 80px; margin-bottom: 5px; }
        #global-status { position: fixed; top: 20px; right: 20px; padding: 10px 20px; background: #fff; border-radius: 4px; box-shadow: 0 2px 8px rgba(0,0,0,0.2); z-index: 9999; }
        .loading { color: #ff9800; }
        .success { color: #4CAF50; }
        .error { color: #f44336; }
    </style>
</head>
<body>
<div id="global-status" class="loading">初始化中...</div>
<div class="container">
    <div id="text1">Audio Codec Samples <br/> Playback by Different BPS (640/1200/3000)</div>
    <div id="intro">
        <p>Speech Codec Audio Samples - Groundtruth and Various Codec Comparisons</p>
        <p>Supported BPS: 640bps, 1200bps, 3000bps</p>
        <p>Codecs: groundtruth, encodec, hificodec, ticodec, wavtokenizer, cCodec</p>
    </div>
</div>

<script>
    // 核心修复：1. 定义Raw路径 2. 全局音频解锁标记 3. 状态反馈
    const RAW_BASE_URL = 'https://raw.githubusercontent.com/shaokai1209/c-Codec/main/';
    let audioUnlocked = false; // 标记音频是否被用户交互解锁
    const statusEl = document.getElementById('global-status');

    // 修复1：用户点击页面任意位置解锁音频（解决浏览器自动播放策略）
    document.addEventListener('click', async () => {
        if (!audioUnlocked) {
            try {
                // 创建空音频实例触发解锁
                const tempAudio = new Audio();
                await tempAudio.play();
                tempAudio.pause();
                audioUnlocked = true;
                statusEl.textContent = '音频已解锁 ✅';
                statusEl.className = 'success';
            } catch (e) {
                statusEl.textContent = '音频解锁失败 ❌';
                statusEl.className = 'error';
                console.error('音频解锁失败:', e);
            }
        }
    }, { once: true });

    // 修复2：重构Wavesurfer创建函数（增加加载状态+错误处理）
    function createWaveSurfer(elementId, audioRelativePath) {
        const audioFullUrl = RAW_BASE_URL + audioRelativePath;
        const wavesurfer = WaveSurfer.create({
            container: '#' + elementId,
            waveColor: 'violet',
            progressColor: 'purple',
            cursorColor: 'red',
            barWidth: 2,
            barRadius: 3,
            responsive: true,
            height: 80,
            backend: 'WebAudio' // 强制使用WebAudio后端（修复播放无响应）
        });

        // 加载音频+监听状态
        wavesurfer.load(audioFullUrl);
        wavesurfer.on('loading', (progress) => {
            statusEl.textContent = `加载中: ${audioRelativePath} (${progress}%)`;
            statusEl.className = 'loading';
        });
        wavesurfer.on('ready', () => {
            statusEl.textContent = `就绪: ${audioRelativePath}`;
            statusEl.className = 'success';
        });
        wavesurfer.on('error', (err) => {
            statusEl.textContent = `失败: ${audioRelativePath} - ${err}`;
            statusEl.className = 'error';
            console.error(`Wavesurfer错误 [${elementId}]:`, err, audioFullUrl);
            alert(`音频加载失败:\n${audioRelativePath}\n错误: ${err}\n请检查文件路径是否正确`);
        });
        wavesurfer.on('play', () => {
            statusEl.textContent = `播放中: ${audioRelativePath}`;
            statusEl.className = 'success';
        });
        wavesurfer.on('pause', () => {
            statusEl.textContent = `已暂停: ${audioRelativePath}`;
            statusEl.className = 'success';
        });

        // 修复3：手动绑定播放/暂停方法（防止作用域丢失）
        wavesurfer.customPlayPause = function() {
            if (!audioUnlocked) {
                alert('请先点击页面任意位置解锁音频！');
                return;
            }
            try {
                this.playPause();
            } catch (e) {
                alert(`播放失败: ${e.message}`);
                console.error('播放失败:', e);
            }
        };

        return wavesurfer;
    }
</script>

<!-- 640bps 样本 -->
<div class="content-container">
    <div class="content-title">640bps Audio Samples</div>
    <table border="0" class="inlineTable">
        <tr>
            <th>Sample</th>
            <th>Groundtruth</th>
            <th>Encodec</th>
            <th>HifiCodec</th>
            <th>TiCodec</th>
            <th>WavTokenizer</th>
            <th>cCodec</th>
        </tr>
        <tr>
            <th>s1</th>
            <td>
                <div id="640_s1_groundtruth"></div>
                <button class="play-button-demo" onclick="wavesurfer_640_s1_groundtruth.customPlayPause()">
                    <i class="fa fa-play"></i> Play / <i class="fa fa-pause"></i> Pause
                </button>
                <script>var wavesurfer_640_s1_groundtruth = createWaveSurfer('640_s1_groundtruth', 'samples/640bps/s1/121_121726_000004_000003.wav');</script>
            </td>
            <td>
                <div id="640_s1_encodec"></div>
                <button class="play-button-demo" onclick="wavesurfer_640_s1_encodec.customPlayPause()">
                    <i class="fa fa-play"></i> Play / <i class="fa fa-pause"></i> Pause
                </button>
                <script>var wavesurfer_640_s1_encodec = createWaveSurfer('640_s1_encodec', 'samples/640bps/s1/121_121726_000004_000003_encodec_640.wav');</script>
            </td>
            <td>
                <div id="640_s1_hifi"></div>
                <button class="play-button-demo" onclick="wavesurfer_640_s1_hifi.customPlayPause()">
                    <i class="fa fa-play"></i> Play / <i class="fa fa-pause"></i> Pause
                </button>
                <script>var wavesurfer_640_s1_hifi = createWaveSurfer('640_s1_hifi', 'samples/640bps/s1/121_121726_000004_000003_hifi_640.wav');</script>
            </td>
            <td>
                <div id="640_s1_ticodec"></div>
                <button class="play-button-demo" onclick="wavesurfer_640_s1_ticodec.customPlayPause()">
                    <i class="fa fa-play"></i> Play / <i class="fa fa-pause"></i> Pause
                </button>
                <script>var wavesurfer_640_s1_ticodec = createWaveSurfer('640_s1_ticodec', 'samples/640bps/s1/121_121726_000004_000003_ticodec_640.wav');</script>
            </td>
            <td>
                <div id="640_s1_wavt"></div>
                <button class="play-button-demo" onclick="wavesurfer_640_s1_wavt.customPlayPause()">
                    <i class="fa fa-play"></i> Play / <i class="fa fa-pause"></i> Pause
                </button>
                <script>var wavesurfer_640_s1_wavt = createWaveSurfer('640_s1_wavt', 'samples/640bps/s1/121_121726_000004_000003_wavt_640.wav');</script>
            </td>
            <td>
                <div id="640_s1_ccodec"></div>
                <button class="play-button-demo" onclick="wavesurfer_640_s1_ccodec.customPlayPause()">
                    <i class="fa fa-play"></i> Play / <i class="fa fa-pause"></i> Pause
                </button>
                <script>var wavesurfer_640_s1_ccodec = createWaveSurfer('640_s1_ccodec', 'samples/640bps/s1/121_121726_000004_000003_cCodec_640.wav');</script>
            </td>
        </tr>
        <!-- 其他s2/s3行保持不变，仅将onclick改为customPlayPause() -->
        <tr>
            <th>s2</th>
            <td>
                <div id="640_s2_groundtruth"></div>
                <button class="play-button-demo" onclick="wavesurfer_640_s2_groundtruth.customPlayPause()">
                    <i class="fa fa-play"></i> Play / <i class="fa fa-pause"></i> Pause
                </button>
                <script>var wavesurfer_640_s2_groundtruth = createWaveSurfer('640_s2_groundtruth', 'samples/640bps/s2/121_121726_000005_000001.wav');</script>
            </td>
            <td>
                <div id="640_s2_encodec"></div>
                <button class="play-button-demo" onclick="wavesurfer_640_s2_encodec.customPlayPause()">
                    <i class="fa fa-play"></i> Play / <i class="fa fa-pause"></i> Pause
                </button>
                <script>var wavesurfer_640_s2_encodec = createWaveSurfer('640_s2_encodec', 'samples/640bps/s2/121_121726_000005_000001_encodec_640.wav');</script>
            </td>
            <td>
                <div id="640_s2_hifi"></div>
                <button class="play-button-demo" onclick="wavesurfer_640_s2_hifi.customPlayPause()">
                    <i class="fa fa-play"></i> Play / <i class="fa fa-pause"></i> Pause
                </button>
                <script>var wavesurfer_640_s2_hifi = createWaveSurfer('640_s2_hifi', 'samples/640bps/s2/121_121726_000005_000001_hifi_640.wav');</script>
            </td>
            <td>
                <div id="640_s2_ticodec"></div>
                <button class="play-button-demo" onclick="wavesurfer_640_s2_ticodec.customPlayPause()">
                    <i class="fa fa-play"></i> Play / <i class="fa fa-pause"></i> Pause
                </button>
                <script>var wavesurfer_640_s2_ticodec = createWaveSurfer('640_s2_ticodec', 'samples/640bps/s2/121_121726_000005_000001_ticodec_640.wav');</script>
            </td>
            <td>
                <div id="640_s2_wavt"></div>
                <button class="play-button-demo" onclick="wavesurfer_640_s2_wavt.customPlayPause()">
                    <i class="fa fa-play"></i> Play / <i class="fa fa-pause"></i> Pause
                </button>
                <script>var wavesurfer_640_s2_wavt = createWaveSurfer('640_s2_wavt', 'samples/640bps/s2/121_121726_000005_000001_wavt_640.wav');</script>
            </td>
            <td>
                <div id="640_s2_ccodec"></div>
                <button class="play-button-demo" onclick="wavesurfer_640_s2_ccodec.customPlayPause()">
                    <i class="fa fa-play"></i> Play / <i class="fa fa-pause"></i> Pause
                </button>
                <script>var wavesurfer_640_s2_ccodec = createWaveSurfer('640_s2_ccodec', 'samples/640bps/s2/121_121726_000005_000001_cCodec_640.wav');</script>
            </td>
        </tr>
        <tr>
            <th>s3</th>
            <td>
                <div id="640_s3_groundtruth"></div>
                <button class="play-button-demo" onclick="wavesurfer_640_s3_groundtruth.customPlayPause()">
                    <i class="fa fa-play"></i> Play / <i class="fa fa-pause"></i> Pause
                </button>
                <script>var wavesurfer_640_s3_groundtruth = createWaveSurfer('640_s3_groundtruth', 'samples/640bps/s3/121_121726_000007_000003.wav');</script>
            </td>
            <td>
                <div id="640_s3_encodec"></div>
                <button class="play-button-demo" onclick="wavesurfer_640_s3_encodec.customPlayPause()">
                    <i class="fa fa-play"></i> Play / <i class="fa fa-pause"></i> Pause
                </button>
                <script>var wavesurfer_640_s3_encodec = createWaveSurfer('640_s3_encodec', 'samples/640bps/s3/121_121726_000007_000003_encodec_640.wav');</script>
            </td>
            <td>
                <div id="640_s3_hifi"></div>
                <button class="play-button-demo" onclick="wavesurfer_640_s3_hifi.customPlayPause()">
                    <i class="fa fa-play"></i> Play / <i class="fa fa-pause"></i> Pause
                </button>
                <script>var wavesurfer_640_s3_hifi = createWaveSurfer('640_s3_hifi', 'samples/640bps/s3/121_121726_000007_000003_hifi_640.wav');</script>
            </td>
            <td>
                <div id="640_s3_ticodec"></div>
                <button class="play-button-demo" onclick="wavesurfer_640_s3_ticodec.customPlayPause()">
                    <i class="fa fa-play"></i> Play / <i class="fa fa-pause"></i> Pause
                </button>
                <script>var wavesurfer_640_s3_ticodec = createWaveSurfer('640_s3_ticodec', 'samples/640bps/s3/121_121726_000007_000003_ticodec_640.wav');</script>
            </td>
            <td>
                <div id="640_s3_wavt"></div>
                <button class="play-button-demo" onclick="wavesurfer_640_s3_wavt.customPlayPause()">
                    <i class="fa fa-play"></i> Play / <i class="fa fa-pause"></i> Pause
                </button>
                <script>var wavesurfer_640_s3_wavt = createWaveSurfer('640_s3_wavt', 'samples/640bps/s3/121_121726_000007_000003_wavt_640.wav');</script>
            </td>
            <td>
                <div id="640_s3_ccodec"></div>
                <button class="play-button-demo" onclick="wavesurfer_640_s3_ccodec.customPlayPause()">
                    <i class="fa fa-play"></i> Play / <i class="fa fa-pause"></i> Pause
                </button>
                <script>var wavesurfer_640_s3_ccodec = createWaveSurfer('640_s3_ccodec', 'samples/640bps/s3/121_121726_000007_000003_cCodec_640.wav');</script>
            </td>
        </tr>
    </table>
</div>

<!-- 1200bps/3000bps 部分按同样规则修改：
     1. onclick改为 customPlayPause()
     2. 保留createWaveSurfer调用逻辑
     以下仅展示1200bps s1示例，其余行/区块同理 -->
<div class="content-container">
    <div class="content-title">1200bps Audio Samples</div>
    <table border="0" class="inlineTable">
        <tr>
            <th>Sample</th>
            <th>Groundtruth</th>
            <th>Encodec</th>
            <th>HifiCodec</th>
            <th>TiCodec</th>
            <th>WavTokenizer</th>
            <th>cCodec</th>
        </tr>
        <tr>
            <th>s1</th>
            <td>
                <div id="1200_s1_groundtruth"></div>
                <button class="play-button-demo" onclick="wavesurfer_1200_s1_groundtruth.customPlayPause()">
                    <i class="fa fa-play"></i> Play / <i class="fa fa-pause"></i> Pause
                </button>
                <script>var wavesurfer_1200_s1_groundtruth = createWaveSurfer('1200_s1_groundtruth', 'samples/1200bps/s1/121_121726_000004_000003.wav');</script>
            </td>
            <td>
                <div id="1200_s1_encodec"></div>
                <button class="play-button-demo" onclick="wavesurfer_1200_s1_encodec.customPlayPause()">
                    <i class="fa fa-play"></i> Play / <i class="fa fa-pause"></i> Pause
                </button>
                <script>var wavesurfer_1200_s1_encodec = createWaveSurfer('1200_s1_encodec', 'samples/1200bps/s1/121_121726_000004_000003_encodec_1200.wav');</script>
            </td>
            <td>
                <div id="1200_s1_hifi"></div>
                <button class="play-button-demo" onclick="wavesurfer_1200_s1_hifi.customPlayPause()">
                    <i class="fa fa-play"></i> Play / <i class="fa fa-pause"></i> Pause
                </button>
                <script>var wavesurfer_1200_s1_hifi = createWaveSurfer('1200_s1_hifi', 'samples/1200bps/s1/121_121726_000004_000003_hifi_1200.wav');</script>
            </td>
            <td>
                <div id="1200_s1_ticodec"></div>
                <button class="play-button-demo" onclick="wavesurfer_1200_s1_ticodec.customPlayPause()">
                    <i class="fa fa-play"></i> Play / <i class="fa fa-pause"></i> Pause
                </button>
                <script>var wavesurfer_1200_s1_ticodec = createWaveSurfer('1200_s1_ticodec', 'samples/1200bps/s1/121_121726_000004_000003_ticodec_1200.wav');</script>
            </td>
            <td>
                <div id="1200_s1_wavt"></div>
                <button class="play-button-demo" onclick="wavesurfer_1200_s1_wavt.customPlayPause()">
                    <i class="fa fa-play"></i> Play / <i class="fa fa-pause"></i> Pause
                </button>
                <script>var wavesurfer_1200_s1_wavt = createWaveSurfer('1200_s1_wavt', 'samples/1200bps/s1/121_121726_000004_000003_wavt_1200.wav');</script>
            </td>
            <td>
                <div id="1200_s1_ccodec"></div>
                <button class="play-button-demo" onclick="wavesurfer_1200_s1_ccodec.customPlayPause()">
                    <i class="fa fa-play"></i> Play / <i class="fa fa-pause"></i> Pause
                </button>
                <script>var wavesurfer_1200_s1_ccodec = createWaveSurfer('1200_s1_ccodec', 'samples/1200bps/s1/121_121726_000004_000003_cCodec_1200.wav');</script>
            </td>
        </tr>
        <!-- 1200bps s2/s3、3000bps 所有行按上述规则修改，替换onclick为customPlayPause() -->
    </table>
</div>

<!-- 3000bps 区块同理，此处省略重复代码，按1200bps规则修改即可 -->

</body>
</html>
